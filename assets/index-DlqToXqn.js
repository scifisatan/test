var D=Object.defineProperty;var R=(a,e,s)=>e in a?D(a,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[e]=s;var k=(a,e,s)=>R(a,typeof e!="symbol"?e+"":e,s);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function s(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(r){if(r.ep)return;r.ep=!0;const n=s(r);fetch(r.href,n)}})();class b{constructor(e,s){k(this,"mainLoop",e=>{if(!this.isRunning)return;let s=e-this.lastTime;for(this.lastTime=e,this.accumulatedTime+=s;this.accumulatedTime>=this.timeStep;)this.update(this.timeStep),this.accumulatedTime-=this.timeStep;this.render(),this.rafId=requestAnimationFrame(this.mainLoop)});this.lastTime=0,this.accumulatedTime=0,this.timeStep=1e3/60,this.update=e,this.render=s,this.rafId=null,this.isRunning=!1}start(){this.isRunning=!0,this.rafId=requestAnimationFrame(this.mainLoop)}stop(){this.rafId&&cancelAnimationFrame(this.rafId),this.isRunning=!1}}class I{constructor(){this.toLoad={sky:"/sprites/sky.png",ground:"/sprites/ground.png",hero:"/sprites/hero-sheet.png",shadow:"/sprites/shadow.png"},this.images={},Object.keys(this.toLoad).forEach(e=>{const s=new Image;s.src=this.toLoad[e],this.images[e]={image:s,isLoaded:!1},s.onload=()=>{this.images[e].isLoaded=!0},s.onerror=i=>{this.images[e].error=i,console.error(`Error loading image ${e}:`,i)}})}}const L=new I;class c{constructor(e=0,s=0){this.x=e,this.y=s}duplicate(){return new c(this.x,this.y)}}class T{constructor({resource:e,frameSize:s,hFrames:i,vFrames:r,frame:n,scale:d,position:m,animations:w}){this.resource=e,this.frameSize=s??new c(16,16),this.hFrames=i??1,this.vFrames=r??1,this.frame=n??0,this.frameMap=new Map,this.scale=d??1,this.position=m??new c(0,0),this.animations=w??{},this.buildFrameMap()}buildFrameMap(){let e=0;for(let s=0;s<this.vFrames;s++)for(let i=0;i<this.hFrames;i++)this.frameMap.set(e,new c(i*this.frameSize.x,s*this.frameSize.y)),e++}step(e){this.animations&&(this.animations.step(e),this.frame=this.animations.frame)}drawImage(e,s,i){if(!this.resource.isLoaded)return;let r=0,n=0;const d=this.frameMap.get(this.frame);d&&(r=d.x,n=d.y);const m=this.frameSize.x,w=this.frameSize.y;e.drawImage(this.resource.image,r,n,m,w,s,i,m*this.scale,w*this.scale)}}const g="LEFT",y="RIGHT",A="UP",u="DOWN";class F{constructor(){this.heldDirections=[],document.addEventListener("keydown",e=>{switch(e.key){case"w":case"ArrowUp":this.onArrowPressed(A);break;case"a":case"ArrowLeft":this.onArrowPressed(g);break;case"s":case"ArrowDown":this.onArrowPressed(u);break;case"d":case"ArrowRight":this.onArrowPressed(y);break}}),document.addEventListener("keyup",e=>{switch(e.key){case"w":case"ArrowUp":this.onArrowReleased(A);break;case"a":case"ArrowLeft":this.onArrowReleased(g);break;case"s":case"ArrowDown":this.onArrowReleased(u);break;case"d":case"ArrowRight":this.onArrowReleased(y);break}})}get direction(){return this.heldDirections[0]}onArrowPressed(e){this.heldDirections.indexOf(e)===-1&&this.heldDirections.unshift(e)}onArrowReleased(e){const s=this.heldDirections.indexOf(e);s!==-1&&this.heldDirections.splice(s,1)}}const v=a=>a*16,O=(a,e,s)=>{const i=`${e},${s}`;return!a.has(i)};function z(a,e,s){let i=e.x-a.position.x,r=e.y-a.position.y,n=Math.sqrt(i*i+r*r);if(n<s)a.position.x=e.x,a.position.y=e.y;else{let d=i/n,m=r/n;a.position.x+=d*s,a.position.y+=m*s,i=e.x-a.position.x,r=e.y-a.position.y,n=Math.sqrt(i*i+r*r)}return n}const t=new Set;t.add("64,48");t.add("128,48");t.add("144,48");t.add("64,64");t.add("64,80");t.add("80,64");t.add("80,80");t.add("112,80");t.add("128,80");t.add("144,80");t.add("160,80");t.add("192,96");t.add("208,96");t.add("224,96");t.add("208,64");t.add("224,64");t.add("224,32");t.add("96,32");t.add("80,32");t.add("64,32");t.add("48,32");t.add("32,32");t.add("32,48");t.add("32,64");t.add("32,80");t.add("32,96");t.add("32,112");t.add("48,112");t.add("64,112");t.add("80,112");t.add("96,112");t.add("112,112");t.add("128,112");t.add("144,112");t.add("160,112");t.add("176,112");t.add("192,112");t.add("208,112");t.add("224,112");t.add("240,112");t.add("256,48");t.add("256,64");t.add("256,80");t.add("256,96");t.add("240,32");t.add("112,16");t.add("128,16");t.add("144,16");t.add("160,16");t.add("176,16");t.add("192,16");t.add("208,16");t.add("224,16");t.add("240,16");class N{constructor(e){this.patterns=e,this.activeKey=Object.keys(this.patterns)[0]}get frame(){return this.patterns[this.activeKey].frame}play(e,s=0){if(!this.patterns[e])throw new Error(`No pattern found for key ${e}`);this.activeKey!==e&&(this.activeKey=e,this.patterns[this.activeKey].currentTime=s)}step(e){this.patterns[this.activeKey].step(e)}}class h{constructor(e){this.currentTime=0,this.animationConfig=e,this.duration=e.duration??500}get frame(){const{frames:e}=this.animationConfig;for(let s=e.length-1;s>=0;s--){const i=e[s];if(this.currentTime>=i.time)return i.frame}throw new Error("No frame found")}step(e){this.currentTime+=e,this.currentTime>this.duration&&(this.currentTime=0)}}const S=(a=0)=>({duration:400,frames:[{time:0,frame:a+1},{time:100,frame:a},{time:200,frame:a+1},{time:300,frame:a+2}]}),x=(a=0)=>({duration:400,frames:[{time:0,frame:a}]}),P=S(0),E=S(3),K=S(6),W=S(9),M=x(1),U=x(4),_=x(7),q=x(10),C=document.querySelector("#game-canvas"),p=C.getContext("2d"),X=new T({resource:L.images.sky,frameSize:new c(320,180)}),Y=new T({resource:L.images.ground,frameSize:new c(320,180)}),o=new T({resource:L.images.hero,frameSize:new c(32,32),hFrames:3,vFrames:8,frame:1,position:new c(v(6),v(5)),animations:new N({walkLeft:new h(W),walkUp:new h(K),walkDown:new h(P),walkRight:new h(E),standLeft:new h(q),standUp:new h(_),standDown:new h(M),standRight:new h(U)})}),f=o.position.duplicate();let l=u;const G=new T({resource:L.images.shadow,frameSize:new c(32,32)}),H=new F,$=a=>{z(o,f,1)<=1&&j(),o.step(a)},j=()=>{const a=H.direction;let e=f.x,s=f.y;const i=16;if(!a){l===A&&o.animations.play("standUp"),l===u&&o.animations.play("standDown"),l===g&&o.animations.play("standLeft"),l===y&&o.animations.play("standRight");return}switch(a){case A:s-=i,o.animations.play("walkUp");break;case u:s+=i,o.animations.play("walkDown");break;case g:e-=i,o.animations.play("walkLeft");break;case y:e+=i,o.animations.play("walkRight");break}l=a??l,O(t,e,s)&&(f.x=e,f.y=s)},B=()=>{X.drawImage(p,0,0),Y.drawImage(p,0,0);const a=new c(-8,-21),e=o.position.x+a.x,s=o.position.y+a.y;G.drawImage(p,e,s),o.drawImage(p,e,s)},J=new b($,B);J.start();
